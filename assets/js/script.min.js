/**
 * 이 파일은 읽기 쉬운 원본 자바스크립트 파일입니다.
 * 웹사이트에 배포할 때는 이 파일을 압축(minify)하여 사용하세요.
 */

document.addEventListener('DOMContentLoaded', () => {

  // ===== 데이터 객체 =====
  const partnerDetails = {
    Google: {
      title: 'Google (Adx, SDK, PD, OB 등)',
      description: '세계 최대 광고 수요를 바탕으로 한 높은 채움(Fill-Rate)과 안정적인 수익을 제공합니다. 브랜드 세이프티 필터링과 모든 주요 포맷을 지원합니다.',
      url: 'https://admanager.google.com/'
    },
    AppLovin: {
      title: 'AppLovin (SDK, MAX 미디에이션)',
      description: '강력한 보상형 동영상 수요를 통해 게임 앱에서 높은 광고 단가(eCPM)를 기대할 수 있으며, 신규 사용자 획득(UA) 캠페인에도 효과적입니다.',
      url: 'https://www.applovin.com/'
    },
    Pangle: {
      title: 'Pangle (SDK, 미디에이션)',
      description: 'TikTok의 강력한 알고리즘을 기반으로, 한국을 포함한 아시아권에서 높은 성과를 보이는 숏폼(Short-form) 동영상 광고를 제공합니다.',
      url: 'https://www.pangleglobal.com/'
    },
    InMobi: {
      title: 'InMobi (SDK, 미디에이션, OB)',
      description: '아시아·인도 시장에서 강력, 브랜드 및 퍼포먼스 수요 혼합.',
      url: 'https://www.inmobi.com/'
    },
    DigitalTurbine: {
      title: 'Digital Turbine (미디에이션, SDK 예정)',
      description: 'Telco 및 OEM 단말 기반 광고 네트워크, 앱 보상형·비디오 강세.',
      url: 'https://www.digitalturbine.com/'
    },
    TheTradeDesk: {
      title: 'The Trade Desk (Adx, PD)',
      description: '세계 최대 독립 DSP, 브랜드·CTV(Connected TV)·프리미엄 광고주 수요 큼.',
      url: 'https://www.thetradedesk.com/'
    },
    RTBHouse: {
      title: 'RTB House (Adx, PD)',
      description: 'AI 기반 리타게팅 DSP, 전자상거래/리마케팅 캠페인 강세.',
      url: 'https://www.rtbhouse.com/'
    },
    PubMatic: {
      title: 'PubMatic (Adx, PD, OB)',
      description: '글로벌 SSP, 대형 퍼블리셔 네트워크, Header Bidding/CTV 강세.',
      url: 'https://pubmatic.com/'
    },
    Fluct: {
      title: 'Fluct (Adx, PD, OB)',
      description: '일본 시장의 강력한 SSP 파트너로, 최근 아시아 전역으로 영향력을 확대하고 있어 새로운 광고 수익 기회를 제공합니다.',
      url: 'https://corp.fluct.jp/'
    },
    OpenX: {
      title: 'OpenX (Adx, OB)',
      description: '높은 투명성과 업계 최고 수준의 무효 트래픽(IVT) 방지 기술을 강점으로 하는 신뢰도 높은 글로벌 SSP입니다.',
      url: 'https://www.openx.com'
    }
  };

  // ===== 부드러운 스크롤 =====
  function scrollToSection(sectionId) {
    const section = document.getElementById(sectionId);
    if (section) {
      section.scrollIntoView({ behavior: 'smooth' });
    }
  }

  document.querySelectorAll('[data-scroll-to]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const sectionId = this.getAttribute('data-scroll-to');
      scrollToSection(sectionId);

      // 모바일 메뉴의 링크인 경우, 메뉴를 닫음
      if (this.classList.contains('mobile-nav-link')) {
        toggleMobileMenu();
      }
    });
  });

  // ===== 모바일 네비게이션 토글 =====
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');

  function toggleMobileMenu() {
    const isHidden = mobileMenu.classList.contains('hidden');
    if (isHidden) {
      mobileMenu.classList.remove('hidden');
      mobileMenuButton.innerHTML = '<span class="material-icons">close</span>';
    } else {
      mobileMenu.classList.add('hidden');
      mobileMenuButton.innerHTML = '<span class="material-icons">menu</span>';
    }
  }

  if (mobileMenuButton) {
    mobileMenuButton.addEventListener('click', toggleMobileMenu);
  }

  // ===== Swiper 슬라이더 =====
  if (typeof Swiper !== 'undefined') {
    new Swiper(".heroSwiper", {
      pagination: { el: ".swiper-pagination" },
      autoplay: { delay: 4000 },
      loop: true
    });
    new Swiper(".credSwiper", {
      slidesPerView: 1,
      loop: true,
      autoplay: { delay: 2500 }
    });
    new Swiper(".serviceSwiper", {
      slidesPerView: 1,
      loop: true,
      autoplay: { delay: 3000 }
    });

    new Swiper(".logo-swiper", {
      slidesPerView: 'auto',
      spaceBetween: 40,
      loop: true,
      allowTouchMove: true,
      autoplay: {
        delay: 0,
        disableOnInteraction: false,
      },
      speed: 8000, // 40초 / 5 = 8초
    });

    // 로고 캐러셀 클릭 이벤트 위임
    const logoSwiperElement = document.querySelector('.logo-swiper');
    if (logoSwiperElement) {
      logoSwiperElement.addEventListener('click', (event) => {
        const button = event.target.closest('.partner-logo-button');
        if (button && button.dataset.partner) {
          openModal(button.dataset.partner);
        }
      });
    }
  }

  // ===== 파트너 모달 =====
  const partnerModal = document.getElementById('partnerModal');
  const modalBody = document.getElementById('modal-body');
  const closeModalButton = document.getElementById('modal-close-button');

  function openModal(partnerName) {
    const details = partnerDetails[partnerName];
    if (partnerModal && modalBody && details) {
      modalBody.innerHTML = `<h3>${details.title}</h3><p>${details.description}</p><a href="${details.url}" target="_blank" rel="noopener noreferrer" class="modal-link">사이트 바로가기 →</a>`;
      partnerModal.style.display = 'flex';
    }
  }

  function closeModal() {
    if (partnerModal) {
      partnerModal.style.display = 'none';
    }
  }

  document.querySelectorAll('[data-partner]').forEach(button => {
    button.addEventListener('click', () => {
      const partnerName = button.getAttribute('data-partner');
      openModal(partnerName);
    });
  });

  if (closeModalButton) {
    closeModalButton.addEventListener('click', closeModal);
  }
  // 모달 외부 클릭 시 닫기
  if (partnerModal) {
      partnerModal.addEventListener('click', (event) => {
          if (event.target === partnerModal) {
              closeModal();
          }
      });
  }


  // ===== 가로형 연혁 그래프 툴팁 =====
  const points = document.querySelectorAll(".point");
  const tooltip = document.getElementById("tooltip");

  if(points.length > 0 && tooltip) {
    points.forEach(point => {
      point.addEventListener("mouseenter", (event) => {
        const year = point.getAttribute("data-year");
        const text = point.getAttribute("data-text");
        tooltip.innerHTML = `<strong>${year}</strong><br>${text}`;
        
        const rect = event.target.getBoundingClientRect();
        tooltip.style.left = rect.left + window.scrollX + rect.width / 2 + 'px';
        tooltip.style.top = rect.top + window.scrollY - 10 + 'px';
        tooltip.style.display = "block";
      });

      point.addEventListener("mouseleave", () => {
        tooltip.style.display = "none";
      });

      // 클릭 시에도 툴팁 고정 (모바일 대응)
      point.addEventListener("click", (event) => {
        const year = point.getAttribute("data-year");
        const text = point.getAttribute("data-text");
        tooltip.innerHTML = `<strong>${year}</strong><br>${text}`;
        
        const rect = event.target.getBoundingClientRect();
        tooltip.style.left = rect.left + window.scrollX + rect.width / 2 + 'px';
        tooltip.style.top = rect.top + window.scrollY - 10 + 'px';
        tooltip.style.display = "block";
      });
    });
  }

  // ===== GNI 워크숍 플레이리스트 =====
  const gniPlaylist = document.getElementById('gni-playlist');
  const gniVideoPlayer = document.getElementById('gni-video-player');

  if (gniPlaylist && gniVideoPlayer) {
    gniPlaylist.addEventListener('click', (event) => {
      const button = event.target.closest('button[data-video-id]');
      if (!button) return;

      const videoId = button.dataset.videoId;
      gniVideoPlayer.src = `https://www.youtube.com/embed/${videoId}`;

      // 활성 상태 업데이트
      const currentActive = gniPlaylist.querySelector('li.active');
      if (currentActive) {
        currentActive.classList.remove('active');
      }
      button.parentElement.classList.add('active');
    });
  }
});
