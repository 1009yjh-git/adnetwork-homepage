/**
 * 이 파일은 읽기 쉬운 원본 자바스크립트 파일입니다.
 * 웹사이트에 배포할 때는 이 파일을 압축(minify)하여 사용하세요.
 */

document.addEventListener('DOMContentLoaded', () => {

  // ===== 데이터 객체 =====
  const partnerDetails = {
    Google: {
      title: 'Google',
      description: '넥스트페이퍼는 구글의 공식 인증 파트너(Google Certified Publishing Partner)입니다. 구글 애드 매니저, 애드몹, 애드센스 등 광고 플랫폼에 대한 전문적인 기술 지원과 컨설팅을 제공합니다.'
    },
    AppLovin: {
      title: 'AppLovin',
      description: 'AppLovin과의 파트너십을 통해 앱 개발자들에게 강력한 수익화 솔루션을 제공하며, MAX 미디에이션 연동을 지원합니다.'
    },
    Pangle: {
      title: 'Pangle',
      description: 'Pangle과의 파트너십을 통해 글로벌 시장, 특히 아시아 지역에서 높은 광고 수익을 얻을 수 있도록 돕습니다.'
    }
  };

  // ===== 부드러운 스크롤 =====
  function scrollToSection(sectionId) {
    const section = document.getElementById(sectionId);
    if (section) {
      section.scrollIntoView({ behavior: 'smooth' });
    }
  }

  document.querySelectorAll('[data-scroll-to]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const sectionId = this.getAttribute('data-scroll-to');
      scrollToSection(sectionId);

      // 모바일 메뉴의 링크인 경우, 메뉴를 닫음
      if (this.classList.contains('mobile-nav-link')) {
        toggleMobileMenu();
      }
    });
  });

  // ===== 모바일 네비게이션 토글 =====
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');

  function toggleMobileMenu() {
    const isHidden = mobileMenu.classList.contains('hidden');
    if (isHidden) {
      mobileMenu.classList.remove('hidden');
      mobileMenuButton.innerHTML = '<span class="material-icons">close</span>';
    } else {
      mobileMenu.classList.add('hidden');
      mobileMenuButton.innerHTML = '<span class="material-icons">menu</span>';
    }
  }

  if (mobileMenuButton) {
    mobileMenuButton.addEventListener('click', toggleMobileMenu);
  }

  // ===== Swiper 슬라이더 =====
  if (typeof Swiper !== 'undefined') {
    new Swiper(".heroSwiper", {
      pagination: { el: ".swiper-pagination" },
      autoplay: { delay: 4000 },
      loop: true
    });
    new Swiper(".credSwiper", {
      slidesPerView: 1,
      loop: true,
      autoplay: { delay: 2500 }
    });
    new Swiper(".serviceSwiper", {
      slidesPerView: 1,
      loop: true,
      autoplay: { delay: 3000 }
    });
  }

  // ===== 파트너 모달 =====
  const partnerModal = document.getElementById('partnerModal');
  const modalBody = document.getElementById('modal-body');
  const closeModalButton = document.getElementById('modal-close-button');

  function openModal(partnerName) {
    const details = partnerDetails[partnerName];
    if (partnerModal && modalBody && details) {
      modalBody.innerHTML = `<h3>${details.title}</h3><p>${details.description}</p>`;
      partnerModal.style.display = 'flex';
    }
  }

  function closeModal() {
    if (partnerModal) {
      partnerModal.style.display = 'none';
    }
  }

  document.querySelectorAll('[data-partner]').forEach(button => {
    button.addEventListener('click', () => {
      const partnerName = button.getAttribute('data-partner');
      openModal(partnerName);
    });
  });

  if (closeModalButton) {
    closeModalButton.addEventListener('click', closeModal);
  }
  // 모달 외부 클릭 시 닫기
  if (partnerModal) {
      partnerModal.addEventListener('click', (event) => {
          if (event.target === partnerModal) {
              closeModal();
          }
      });
  }


  // ===== 가로형 연혁 그래프 툴팁 =====
  const points = document.querySelectorAll(".point");
  const tooltip = document.getElementById("tooltip");

  if(points.length > 0 && tooltip) {
    points.forEach(point => {
      point.addEventListener("mouseenter", (event) => {
        const year = point.getAttribute("data-year");
        const text = point.getAttribute("data-text");
        tooltip.innerHTML = `<strong>${year}</strong><br>${text}`;
        
        const rect = event.target.getBoundingClientRect();
        tooltip.style.left = rect.left + window.scrollX + rect.width / 2 + 'px';
        tooltip.style.top = rect.top + window.scrollY - 10 + 'px';
        tooltip.style.display = "block";
      });

      point.addEventListener("mouseleave", () => {
        tooltip.style.display = "none";
      });

      // 클릭 시에도 툴팁 고정 (모바일 대응)
      point.addEventListener("click", (event) => {
        const year = point.getAttribute("data-year");
        const text = point.getAttribute("data-text");
        tooltip.innerHTML = `<strong>${year}</strong><br>${text}`;
        
        const rect = event.target.getBoundingClientRect();
        tooltip.style.left = rect.left + window.scrollX + rect.width / 2 + 'px';
        tooltip.style.top = rect.top + window.scrollY - 10 + 'px';
        tooltip.style.display = "block";
      });
    });
  }
});
