/**
 * 이 파일은 읽기 쉬운 원본 자바스크립트 파일입니다.
 * 웹사이트에 배포할 때는 이 파일을 압축(minify)하여 사용하세요.
 */

document.addEventListener('DOMContentLoaded', () => {

  // ===== 부드러운 스크롤 =====
  function scrollToSection(sectionId) {
    const section = document.getElementById(sectionId);
    if (section) {
      section.scrollIntoView({ behavior: 'smooth' });
    }
  }

  document.querySelectorAll('[data-scroll-to]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const sectionId = this.getAttribute('data-scroll-to');
      scrollToSection(sectionId);

      // 모바일 메뉴의 링크인 경우, 메뉴를 닫음
      if (this.classList.contains('mobile-nav-link')) {
        toggleMobileMenu();
      }
    });
  });

  // ===== 모바일 네비게이션 토글 =====
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');

  function toggleMobileMenu() {
    const isHidden = mobileMenu.classList.contains('hidden');
    if (isHidden) {
      mobileMenu.classList.remove('hidden');
      mobileMenuButton.innerHTML = '<span class="material-icons">close</span>';
    } else {
      mobileMenu.classList.add('hidden');
      mobileMenuButton.innerHTML = '<span class="material-icons">menu</span>';
    }
  }

  if (mobileMenuButton) {
    mobileMenuButton.addEventListener('click', toggleMobileMenu);
  }

  // ===== Swiper 슬라이더 =====
  if (typeof Swiper !== 'undefined') {
    new Swiper(".heroSwiper", {
      pagination: { el: ".swiper-pagination" },
      autoplay: { delay: 4000 },
      loop: true
    });
    new Swiper(".credSwiper", {
      slidesPerView: 1,
      loop: true,
      autoplay: { delay: 2500 }
    });
    new Swiper(".serviceSwiper", {
      slidesPerView: 1,
      loop: true,
      autoplay: { delay: 3000 }
    });

    new Swiper(".logo-swiper", {
      slidesPerView: 'auto',
      spaceBetween: 40,
      loop: true,
      allowTouchMove: true,
      autoplay: {
        delay: 0,
        disableOnInteraction: false,
      },
      speed: 8000, // 40초 / 5 = 8초
    });
  }

  // ===== 파트너 모달 =====
  const partnerModal = document.getElementById('partnerModal');
  const modalBody = document.getElementById('modal-body');
  const closeModalButton = document.getElementById('modal-close-button');

  function openModal(title, description, url) {
    if (partnerModal && modalBody) {
      modalBody.innerHTML = `<h3>${title}</h3><p>${description}</p><a href="${url}" target="_blank" rel="noopener noreferrer nofollow" class="modal-link">사이트 바로가기 →</a>`;
      partnerModal.style.display = 'flex';
    }
  }

  function closeModal() {
    if (partnerModal) {
      partnerModal.style.display = 'none';
    }
  }

  // 파트너 로고 클릭 이벤트 (위임)
  document.body.addEventListener('click', (event) => {
    const link = event.target.closest('.partner-logo-link');
    if (link) {
      event.preventDefault();
      const title = link.dataset.title;
      const description = link.dataset.description;
      const url = link.href;
      openModal(title, description, url);
    }

    // 기존 버튼 방식도 유지 (상단 파트너십 섹션용)
    const button = event.target.closest('.partner-logo-button');
    if (button && button.dataset.partner) {
      const partnerName = button.dataset.partner;
      const details = partnerDetails[partnerName]; // 이 부분은 이제 상단 섹션만 사용
      if(details) {
        openModal(details.title, details.description, details.url);
      }
    }
  });


  if (closeModalButton) {
    closeModalButton.addEventListener('click', closeModal);
  }
  // 모달 외부 클릭 시 닫기
  if (partnerModal) {
      partnerModal.addEventListener('click', (event) => {
          if (event.target === partnerModal) {
              closeModal();
          }
      });
  }


  // ===== 가로형 연혁 그래프 툴팁 =====
  const points = document.querySelectorAll(".point");
  const tooltip = document.getElementById("tooltip");

  if(points.length > 0 && tooltip) {
    points.forEach(point => {
      point.addEventListener("mouseenter", (event) => {
        const year = point.getAttribute("data-year");
        const text = point.getAttribute("data-text");
        tooltip.innerHTML = `<strong>${year}</strong><br>${text}`;
        
        const rect = event.target.getBoundingClientRect();
        tooltip.style.left = rect.left + window.scrollX + rect.width / 2 + 'px';
        tooltip.style.top = rect.top + window.scrollY - 10 + 'px';
        tooltip.style.display = "block";
      });

      point.addEventListener("mouseleave", () => {
        tooltip.style.display = "none";
      });

      // 클릭 시에도 툴팁 고정 (모바일 대응)
      point.addEventListener("click", (event) => {
        const year = point.getAttribute("data-year");
        const text = point.getAttribute("data-text");
        tooltip.innerHTML = `<strong>${year}</strong><br>${text}`;
        
        const rect = event.target.getBoundingClientRect();
        tooltip.style.left = rect.left + window.scrollX + rect.width / 2 + 'px';
        tooltip.style.top = rect.top + window.scrollY - 10 + 'px';
        tooltip.style.display = "block";
      });
    });
  }

  // ===== GNI 워크숍 플레이리스트 =====
  const gniPlaylist = document.getElementById('gni-playlist');
  const gniVideoPlayer = document.getElementById('gni-video-player');

  if (gniPlaylist && gniVideoPlayer) {
    gniPlaylist.addEventListener('click', (event) => {
      const button = event.target.closest('button[data-video-id]');
      if (!button) return;

      const videoId = button.dataset.videoId;
      gniVideoPlayer.src = `https://www.youtube.com/embed/${videoId}`;

      // 활성 상태 업데이트
      const currentActive = gniPlaylist.querySelector('li.active');
      if (currentActive) {
        currentActive.classList.remove('active');
      }
      button.parentElement.classList.add('active');
    });
  }
});
